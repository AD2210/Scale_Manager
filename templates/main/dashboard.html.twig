<!DOCTYPE html>
<html lang="fr">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="description" content="ScaleManager est une application Web de gestion de production">
		<meta name="author" content="Anthony Delbée">
		<meta name="contact" content="contact.webprocreations@gmail.com">
		<meta name="robots" content="noindex, nofollow">
		<meta name="turbo-cache-control" content="no-cache">
		<script src="https://kit.fontawesome.com/988c8cacf7.js" crossorigin="anonymous"></script>
		<title>Dashboard</title>
		{{ encore_entry_link_tags('app') }}
		{{ encore_entry_script_tags('app') }}
	</head>
	<body class="bg-light text-dark overflow-hidden">

		<!-- Menu Offcanvas à droite -->
		<div class="offcanvas offcanvas-end" tabindex="-1" id="projectSelector" aria-labelledby="projectSelectorLabel">
			<div class="offcanvas-header">
				<h5 class="offcanvas-title">Sélection des projets</h5>
				<button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Fermer"></button>
			</div>
			<div class="offcanvas-body" data-controller="dashboard">
				{% for i in 1..4 %}
					<div class="mb-3">
						<label class="form-label">Projet
							{{ i }}</label>
						<select class="form-select" data-action="change->dashboard#update" data-slot="{{ i }}" data-slot-target="select">
							<option value="">-- Sélectionner --</option>
							{% for project in projects %}
								<option value="{{ project.id }}" {% if project.dashboardSlot == i %} selected {% endif %}>
									{{ project.title }}
								</option>
							{% endfor %}
						</select>
					</div>
				{% endfor %}
				<div class="pt-4">
					<a href="{{ path('app_project_index') }}" class="btn btn-outline-secondary">
						<div class="d-flex align-items-center gap-2">
							<i class="fa-solid fa-house"></i>
							Retour accueil
						</div>
					</a>
				</div>
			</div>
		</div>

		<!-- Bouton pour ouvrir le menu -->
        <div class="position-fixed top-50 translate-middle-y end-0 me-1 d-flex align-items-center justify-content-center bg-secondary text-white rounded-start"
             style="width: 30px; height: 120px; cursor: pointer; z-index: 1050;"
             data-bs-toggle="offcanvas" data-bs-target="#projectSelector"
             title="Sélection des projets">
            <i class="fa-solid fa-sliders fa-lg rotate-90"></i>
        </div>

		<!-- Grille des 4 cartes -->
		<div class="container-fluid p-4 pe-5 h-100">
			<div class="row row-cols-1 row-cols-md-2 g-4 h-100">
				{% for project in projectSlots|filter(p => p is not null) %}
					<div class="col h-50">
						<div class="card h-100 shadow-sm border-0 rounded-4 p-3 d-flex flex-column justify-content-between">
							<div>
                                <div class="d-flex justify-content-between align-items-start mb-4">
                                    <!-- Bloc gauche -->
                                    <div>
                                        <h4 class="mb-1">{{ project.title }}</h4>
                                        <p class="mb-1 text-muted">{{ project.customer }}</p>
                                        <p class="mb-0">Resp. : <strong>{{ project.manager }}</strong></p>
                                    </div>

                                    <!-- Bloc centre -->
                                    <div class="text-center flex-grow-1">
                                        <p class="text-uppercase text-muted mb-1">Deadline</p>
                                        <h4 class="fw-semibold">{{ project.deadline|date('d/m/Y') }}</h4>
                                    </div>

                                    <!-- Bloc droit -->
                                    <div class="text-end">
                                        <div class="progress-circle position-relative" style="width: 90px; height: 90px;">
                                            <svg viewBox="0 0 36 36" class="circular-chart">
                                                <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                                                <path class="circle" stroke-dasharray="{{ project.globalProgress }}, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                                            </svg>
                                            <div class="position-absolute ms-2 pb-2 top-50 start-50 translate-middle fw-bold fs-5">
                                                {{ project.globalProgress }}%
                                            </div>
                                        </div>
                                    </div>
                                </div>

								<!-- Workflow des 7 étapes -->
                                <div class="mt-3">
                                    {% for step in project.workflowSteps %}
                                        <div class="d-flex align-items-center mb-3">
                                            <div class="col-4 fw-semibold fs-6">{{ step.label }}</div>
                                            <div class="col-6">
                                                <div class="progress" style="height: 24px;">
                                                    <div class="progress-bar bg-primary fs-5" style="width: {{ step.percent }}%;">
                                                        {{ step.percent }}%
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-2 text-end">
                                                {% if step.percent == 100 %}
                                                    <span class="badge bg-success fs-6">Terminé</span>
                                                {% endif %}
                                            </div>
                                        </div>
                                    {% endfor %}
                                </div>
							</div>
						</div>
					</div>
				{% endfor %}
			</div>
		</div>
	</body>
</html>
